<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ládíkovo procvičování</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f8ff;
            text-align: center;
        }
        .container {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        h1 {
            color: #2c80b9;
            font-size: 28px;
        }
        .problem {
            font-size: 32px;
            margin: 30px 0;
            color: #333;
        }
        input[type="number"] {
            font-size: 24px;
            width: 80px;
            padding: 10px;
            border: 2px solid #2c80b9;
            border-radius: 10px;
            text-align: center;
            display: block;
            margin: 0 auto;
        }
        button {
            font-size: 20px;
            padding: 10px 20px;
            background-color: #2c80b9;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #1a6ea8;
        }
        .score {
            font-size: 24px;
            margin: 20px 0;
            color: #2c80b9;
        }
        .feedback {
            font-size: 24px;
            margin: 20px 0;
            min-height: 30px;
        }
        .correct {
            color: green;
        }
        .incorrect {
            color: red;
        }
        .result-container {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background-color: #e9f7ff;
            border-radius: 15px;
            animation: fadeIn 1s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .stars {
            font-size: 50px;
            color: gold;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            margin: 20px 0;
        }
        .progress-container {
            margin: 20px auto;
            width: 80%;
            height: 20px;
            background-color: #ddd;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #2c80b9;
            transition: width 0.5s;
        }
        .celebration {
            position: absolute;
            font-size: 30px;
            animation: fallDown 2s forwards;
            opacity: 0;
        }
        @keyframes fallDown {
            0% {
                transform: translateY(-50px);
                opacity: 1;
            }
            80% {
                opacity: 1;
            }
            100% {
                transform: translateY(100px);
                opacity: 0;
            }
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .stat-item {
            background-color: #e9f7ff;
            padding: 10px;
            border-radius: 10px;
            width: 45%;
            margin: 5px;
        }
        .mode-selection {
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }
        .mode-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        .mode-btn {
            font-size: 18px;
            padding: 15px;
            background-color: #4c9aff;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        .mode-btn:hover {
            background-color: #3a7bd5;
            transform: scale(1.02);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ládíkovo procvičování</h1>
        
        <div id="mode-selection" class="mode-selection">
            <h2>Vyber si typ příkladů:</h2>
            
            <div class="mode-options">
                <button class="mode-btn" data-mode="1">Násobení a dělení</button>
                <button class="mode-btn" data-mode="2">Sčítání a odčítání do 100</button>
                <button class="mode-btn" data-mode="3">Procvičování i/y</button>
            </div>
        </div>
        
        <div id="game-screen" style="display: none;">
            <div class="score">Body: <span id="score">0</span></div>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="success-rate">Úspěšnost: <span id="current-success-rate">0%</span></div>
            <div class="problem" id="problem"></div>
            <input type="number" id="answer" placeholder="?" min="0" max="100">
            <div>
                <button id="check-btn">Zkontrolovat</button>
            </div>
            <div class="feedback" id="feedback"></div>
        </div>
        
        <div id="result-screen" class="result-container">
            <h2>Gratuluji! Dosáhl/a jsi 50 bodů!</h2>
            <div class="stars">⭐⭐⭐⭐⭐</div>
            <div class="stats">
                <div class="stat-item">
                    <h3>Správné odpovědi</h3>
                    <div id="correct-count">0</div>
                </div>
                <div class="stat-item">
                    <h3>Špatné odpovědi</h3>
                    <div id="incorrect-count">0</div>
                </div>
                <div class="stat-item">
                    <h3>Celkový čas</h3>
                    <div id="total-time">0:00</div>
                </div>
                <div class="stat-item">
                    <h3>Úspěšnost</h3>
                    <div id="success-rate">0%</div>
                </div>
            </div>
            <button id="restart-btn">Hrát znovu</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const modeSelection = document.getElementById('mode-selection');
            const gameScreen = document.getElementById('game-screen');
            const problemElement = document.getElementById('problem');
            const answerInput = document.getElementById('answer');
            const checkButton = document.getElementById('check-btn');
            const feedbackElement = document.getElementById('feedback');
            const scoreElement = document.getElementById('score');
            const progressBar = document.getElementById('progress-bar');
            const resultScreen = document.getElementById('result-screen');
            const restartButton = document.getElementById('restart-btn');
            const correctCountElement = document.getElementById('correct-count');
            const incorrectCountElement = document.getElementById('incorrect-count');
            const totalTimeElement = document.getElementById('total-time');
            
            // Inicializace Web Audio API
            let audioContext;
            
            // Proměnné pro typy testů
            let currentMode = 1;
            let numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; // Čísla pro násobilku a dělení
            let allNumbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; // Všechna možná čísla
            
            // Konfigurace režimů
            const modes = {
                1: { name: "Násobení a dělení od 1 do 10" },
                2: { name: "Sčítání a odčítání do 100" },
                3: { name: "Procvičování i/y v češtině" }
            };
            
            // Inicializace Audio Context při první interakci uživatele
            function initAudio() {
                if (!audioContext) {
                    try {
                        audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    } catch (e) {
                        console.log('Web Audio API není podporováno v tomto prohlížeči.');
                    }
                }
            }
            
            // Funkce pro přehrání zvuků
            function playCorrectSound() {
                if (!audioContext) return;
                
                // Zvuk pro správnou odpověď - veselý tón
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            }
            
            function playWrongSound() {
                if (!audioContext) return;
                
                // Zvuk pro špatnou odpověď - klesající tón
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.3);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            }
            
            function playWinSound() {
                if (!audioContext) return;
                
                // Fanfára pro výhru - sekvence tónů
                const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
                const durations = [0.1, 0.1, 0.1, 0.3];
                
                notes.forEach((freq, i) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.value = freq;
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime + (i * durations[i]));
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + ((i + 1) * durations[i]));
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.start(audioContext.currentTime + (i * durations[i]));
                    oscillator.stop(audioContext.currentTime + ((i + 1) * durations[i]));
                });
            }
            
            let score = 0;
            let correctCount = 0;
            let incorrectCount = 0;
            let currentProblem = {};
            let startTime;
            
            // Sledování jednoduchých příkladů
            let usedEasyProblems = {
                multiplyByOne: false,    // Násobení jedničkou
                divideByOne: false,      // Dělení jedničkou
                multiplyByZero: false,   // Násobení nulou
                divideByItself: false    // Dělení čísla sebou samým
            };
            
            // Inicializace výběru režimu
            function setupModeSelection() {
                // Přidání event listenerů pro tlačítka režimů
                document.querySelectorAll('.mode-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const mode = parseInt(this.getAttribute('data-mode'));
                        selectMode(mode);
                    });
                });
            }
            
            // Výběr režimu
            function selectMode(mode) {
                currentMode = mode;
                startGame();
            }
            
            // Funkce pro procvičování i/y v češtině
            function generateIYProblem() {
                // Databáze slov pro procvičování i/y po měkkých a tvrdých souhláskách
                const words = {
                    // Slova s měkkými souhláskami (i)
                    soft: [
                        { word: "ž_to", answer: "i", fullWord: "žito", rule: "Po ž píšeme měkké i" },
                        { word: "ž_vot", answer: "i", fullWord: "život", rule: "Po ž píšeme měkké i" },
                        { word: "ž_vý", answer: "i", fullWord: "živý", rule: "Po ž píšeme měkké i" },
                        { word: "ž_zeň", answer: "i", fullWord: "žízeň", rule: "Po ž píšeme měkké i" },
                        { word: "ž_rafa", answer: "i", fullWord: "žirafa", rule: "Po ž píšeme měkké i" },
                        { word: "š_roký", answer: "i", fullWord: "široký", rule: "Po š píšeme měkké i" },
                        { word: "š_pka", answer: "i", fullWord: "šipka", rule: "Po š píšeme měkké i" },
                        { word: "š_p", answer: "i", fullWord: "šíp", rule: "Po š píšeme měkké i" },
                        { word: "š_kovný", answer: "i", fullWord: "šikovný", rule: "Po š píšeme měkké i" },
                        { word: "š_ška", answer: "i", fullWord: "šiška", rule: "Po š píšeme měkké i" },
                        { word: "č_stý", answer: "i", fullWord: "čistý", rule: "Po č píšeme měkké i" },
                        { word: "č_slo", answer: "i", fullWord: "číslo", rule: "Po č píšeme měkké i" },
                        { word: "č_lý", answer: "i", fullWord: "čilý", rule: "Po č píšeme měkké i" },
                        { word: "č_rý", answer: "i", fullWord: "čirý", rule: "Po č píšeme měkké i" },
                        { word: "č_perný", answer: "i", fullWord: "čiperný", rule: "Po č píšeme měkké i" },
                        { word: "ř_dit", answer: "i", fullWord: "řídit", rule: "Po ř píšeme měkké i" },
                        { word: "ř_dký", answer: "i", fullWord: "řídký", rule: "Po ř píšeme měkké i" },
                        { word: "ř_jen", answer: "i", fullWord: "říjen", rule: "Po ř píšeme měkké i" },
                        { word: "ř_kat", answer: "i", fullWord: "říkat", rule: "Po ř píšeme měkké i" },
                        { word: "c_hla", answer: "i", fullWord: "cihla", rule: "Po c píšeme měkké i" },
                        { word: "c_l", answer: "i", fullWord: "cíl", rule: "Po c píšeme měkké i" },
                        { word: "c_zí", answer: "i", fullWord: "cizí", rule: "Po c píšeme měkké i" },
                        { word: "c_bule", answer: "i", fullWord: "cibule", rule: "Po c píšeme měkké i" },
                        { word: "c_tron", answer: "i", fullWord: "citron", rule: "Po c píšeme měkké i" },
                        { word: "j_ndy", answer: "i", fullWord: "jindy", rule: "Po j píšeme měkké i" },
                        { word: "j_ný", answer: "i", fullWord: "jiný", rule: "Po j píšeme měkké i" },
                        { word: "j_st", answer: "i", fullWord: "jíst", rule: "Po j píšeme měkké i" },
                        { word: "j_skra", answer: "i", fullWord: "jiskra", rule: "Po j píšeme měkké i" },
                        { word: "j_zda", answer: "i", fullWord: "jízda", rule: "Po j píšeme měkké i" },
                        { word: "d_vný", answer: "i", fullWord: "divný", rule: "Po ď píšeme měkké i" },
                        { word: "d_tě", answer: "i", fullWord: "dítě", rule: "Po ď píšeme měkké i" },
                        { word: "d_voký", answer: "i", fullWord: "divoký", rule: "Po ď píšeme měkké i" },
                        { word: "d_vka", answer: "i", fullWord: "dívka", rule: "Po ď píšeme měkké i" },
                        { word: "d_lo", answer: "i", fullWord: "dílo", rule: "Po ď píšeme měkké i" },
                        { word: "t_síc", answer: "i", fullWord: "tisíc", rule: "Po ť píšeme měkké i" },
                        { word: "t_cho", answer: "i", fullWord: "ticho", rule: "Po ť píšeme měkké i" },
                        { word: "t_ha", answer: "i", fullWord: "tíha", rule: "Po ť píšeme měkké i" },
                        { word: "t_chý", answer: "i", fullWord: "tichý", rule: "Po ť píšeme měkké i" },
                        { word: "t_skárna", answer: "i", fullWord: "tiskárna", rule: "Po ť píšeme měkké i" },
                        { word: "n_c", answer: "i", fullWord: "nic", rule: "Po ň píšeme měkké i" },
                        { word: "n_kdo", answer: "i", fullWord: "nikdo", rule: "Po ň píšeme měkké i" },
                        { word: "n_zký", answer: "i", fullWord: "nízký", rule: "Po ň píšeme měkké i" },
                        { word: "n_tro", answer: "i", fullWord: "nitro", rule: "Po ň píšeme měkké i" },
                        { word: "n_tka", answer: "i", fullWord: "nitka", rule: "Po ň píšeme měkké i" },
                        { word: "č_stič", answer: "i", fullWord: "čistič", rule: "Po č píšeme měkké i" },
                        { word: "ř_dič", answer: "i", fullWord: "řidič", rule: "Po ř píšeme měkké i" },
                        { word: "c_zinec", answer: "i", fullWord: "cizinec", rule: "Po c píšeme měkké i" },
                        { word: "ž_dle", answer: "i", fullWord: "židle", rule: "Po ž píšeme měkké i" },
                        { word: "j_novatka", answer: "i", fullWord: "jinovatka", rule: "Po j píšeme měkké i" }
                    ],
                    // Slova s tvrdými souhláskami (y)
                    hard: [
                        { word: "h_giena", answer: "y", fullWord: "hygiena", rule: "Po h píšeme tvrdé y" },
                        { word: "h_mna", answer: "y", fullWord: "hymna", rule: "Po h píšeme tvrdé y" },
                        { word: "h_bat", answer: "y", fullWord: "hýbat", rule: "Po h píšeme tvrdé y" },
                        { word: "h_nout", answer: "y", fullWord: "hynout", rule: "Po h píšeme tvrdé y" },
                        { word: "h_zdit", answer: "y", fullWord: "hyzdit", rule: "Po h píšeme tvrdé y" },
                        { word: "ch_ba", answer: "y", fullWord: "chyba", rule: "Po ch píšeme tvrdé y" },
                        { word: "ch_tit", answer: "y", fullWord: "chytit", rule: "Po ch píšeme tvrdé y" },
                        { word: "ch_še", answer: "y", fullWord: "chýše", rule: "Po ch píšeme tvrdé y" },
                        { word: "ch_trý", answer: "y", fullWord: "chytrý", rule: "Po ch píšeme tvrdé y" },
                        { word: "ch_stat", answer: "y", fullWord: "chystat", rule: "Po ch píšeme tvrdé y" },
                        { word: "k_tka", answer: "y", fullWord: "kytka", rule: "Po k píšeme tvrdé y" },
                        { word: "k_selý", answer: "y", fullWord: "kyselý", rule: "Po k píšeme tvrdé y" },
                        { word: "k_vat", answer: "y", fullWord: "kývat", rule: "Po k píšeme tvrdé y" },
                        { word: "k_slík", answer: "y", fullWord: "kyslík", rule: "Po k píšeme tvrdé y" },
                        { word: "k_tara", answer: "y", fullWord: "kytara", rule: "Po k píšeme tvrdé y" },
                        { word: "r_ba", answer: "y", fullWord: "ryba", rule: "Po r píšeme tvrdé y" },
                        { word: "r_že", answer: "y", fullWord: "rýže", rule: "Po r píšeme tvrdé y" },
                        { word: "r_ma", answer: "y", fullWord: "rýma", rule: "Po r píšeme tvrdé y" },
                        { word: "r_chlý", answer: "y", fullWord: "rychlý", rule: "Po r píšeme tvrdé y" },
                        { word: "r_č", answer: "y", fullWord: "rýč", rule: "Po r píšeme tvrdé y" },
                        { word: "d_chat", answer: "y", fullWord: "dýchat", rule: "Po d píšeme tvrdé y" },
                        { word: "d_ka", answer: "y", fullWord: "dýka", rule: "Po d píšeme tvrdé y" },
                        { word: "d_ně", answer: "y", fullWord: "dýně", rule: "Po d píšeme tvrdé y" },
                        { word: "d_mka", answer: "y", fullWord: "dýmka", rule: "Po d píšeme tvrdé y" },
                        { word: "d_chavičný", answer: "y", fullWord: "dýchavičný", rule: "Po d píšeme tvrdé y" },
                        { word: "t_č", answer: "y", fullWord: "tyč", rule: "Po t píšeme tvrdé y" },
                        { word: "t_den", answer: "y", fullWord: "týden", rule: "Po t píšeme tvrdé y" },
                        { word: "t_kev", answer: "y", fullWord: "tykev", rule: "Po t píšeme tvrdé y" },
                        { word: "t_gr", answer: "y", fullWord: "tygr", rule: "Po t píšeme tvrdé y" },
                        { word: "n_ní", answer: "y", fullWord: "nyní", rule: "Po n píšeme tvrdé y" },
                        { word: "n_brž", answer: "y", fullWord: "nýbrž", rule: "Po n píšeme tvrdé y" },
                        { word: "n_t", answer: "y", fullWord: "nýt", rule: "Po n píšeme tvrdé y" },
                        { word: "n_lon", answer: "y", fullWord: "nylon", rule: "Po n píšeme tvrdé y" },
                        { word: "h_drant", answer: "y", fullWord: "hydrant", rule: "Po h píšeme tvrdé y" },
                        { word: "h_pnóza", answer: "y", fullWord: "hypnóza", rule: "Po h píšeme tvrdé y" },
                        { word: "h_drolog", answer: "y", fullWord: "hydrolog", rule: "Po h píšeme tvrdé y" },
                        { word: "k_tice", answer: "y", fullWord: "kytice", rule: "Po k píšeme tvrdé y" },
                        { word: "k_čel", answer: "y", fullWord: "kyčel", rule: "Po k píšeme tvrdé y" },
                        { word: "r_ngle", answer: "y", fullWord: "ryngle", rule: "Po r píšeme tvrdé y" },
                        { word: "r_padlo", answer: "y", fullWord: "rypadlo", rule: "Po r píšeme tvrdé y" },
                        { word: "d_namit", answer: "y", fullWord: "dynamit", rule: "Po d píšeme tvrdé y" },
                        { word: "t_l", answer: "y", fullWord: "týl", rule: "Po t píšeme tvrdé y" },
                        { word: "t_mián", answer: "y", fullWord: "tymián", rule: "Po t píšeme tvrdé y" },
                        { word: "p_šný", answer: "y", fullWord: "pyšný", rule: "Po p se většinou píše tvrdé y" },
                        { word: "m_slet", answer: "y", fullWord: "myslet", rule: "Po m píšeme většinou tvrdé y" },
                        { word: "sm_sl", answer: "y", fullWord: "smysl", rule: "Po m píšeme většinou tvrdé y" },
                        { word: "zm_je", answer: "y", fullWord: "zmyje", rule: "Po m píšeme většinou tvrdé y" },
                        { word: "m_š", answer: "y", fullWord: "myš", rule: "Po m píšeme většinou tvrdé y" },
                        { word: "hm_z", answer: "y", fullWord: "hmyz", rule: "Po m píšeme většinou tvrdé y" }
                    ]
                };
                
                // Náhodně vybere, zda půjde o měkkou nebo tvrdou souhlásku
                const isHard = Math.random() < 0.5;
                const wordList = isHard ? words.hard : words.soft;
                
                // Náhodně vybere slovo z příslušného seznamu
                const wordIndex = Math.floor(Math.random() * wordList.length);
                const selectedWord = wordList[wordIndex];
                
                currentProblem = {
                    word: selectedWord.word,
                    answer: selectedWord.answer,
                    rule: selectedWord.rule,
                    fullWord: selectedWord.fullWord
                };
                
                // Zobrazí slovo s vynechaným i/y
                problemElement.textContent = `${currentProblem.word}`;
                // Nastaví správnou odpověď
                answerInput.style.display = 'none'; // Schová numerický input
                
                // Zkontroluje, zda již existují tlačítka pro i/y
                let iyButtons = document.getElementById('iy-buttons');
                if (!iyButtons) {
                    // Vytvoří tlačítka pro volbu i/y
                    iyButtons = document.createElement('div');
                    iyButtons.id = 'iy-buttons';
                    iyButtons.style.margin = '20px 0';
                    
                    const iButton = document.createElement('button');
                    iButton.textContent = 'i';
                    iButton.className = 'mode-btn';
                    iButton.style.margin = '0 10px';
                    iButton.style.width = '60px';
                    iButton.style.height = '60px';
                    iButton.style.fontSize = '24px';
                    iButton.onclick = function() { checkIYAnswer('i'); };
                    
                    const yButton = document.createElement('button');
                    yButton.textContent = 'y';
                    yButton.className = 'mode-btn';
                    yButton.style.margin = '0 10px';
                    yButton.style.width = '60px';
                    yButton.style.height = '60px';
                    yButton.style.fontSize = '24px';
                    yButton.onclick = function() { checkIYAnswer('y'); };
                    
                    iyButtons.appendChild(iButton);
                    iyButtons.appendChild(yButton);
                    
                    // Vloží tlačítka do DOM
                    const inputContainer = answerInput.parentNode;
                    inputContainer.appendChild(iyButtons);
                }
                else {
                    iyButtons.style.display = 'block';
                }
            }
            
            // Funkce pro kontrolu odpovědi u i/y cvičení
            function checkIYAnswer(userAnswer) {
                // Porovnání pouze základního písmene (i/y), bez ohledu na délku (í/ý)
                const correctBase = currentProblem.answer.toLowerCase().charAt(0);
                const userBase = userAnswer.toLowerCase().charAt(0);
                
                if (userBase === correctBase) {
                    // Správná odpověď
                    score++;
                    correctCount++;
                    feedbackElement.textContent = `Správně! ${currentProblem.rule}`;
                    feedbackElement.className = 'feedback correct';
                    createCelebration();
                    // Zvuková i vizuální zpětná vazba
                    playCorrectSound();
                    flashBackground('correct');
                } else {
                    // Špatná odpověď
                    score = Math.max(0, score - 1);
                    incorrectCount++;
                    feedbackElement.textContent = `Špatně! Správná odpověď je "${currentProblem.answer}". ${currentProblem.rule}`;
                    feedbackElement.className = 'feedback incorrect';
                    // Zvuková i vizuální zpětná vazba
                    playWrongSound();
                    flashBackground('incorrect');
                }
                
                // Zobrazení celého slova
                problemElement.textContent = `${currentProblem.fullWord}`;
                
                scoreElement.textContent = score;
                updateProgressBar();
                updateSuccessRate();
                
                // Kontrola, zda bylo dosaženo 50 bodů
                if (score >= 50) {
                    endGame();
                } else {
                    // Po krátké pauze generuje nový příklad
                    setTimeout(function() {
                        generateIYProblem();
                    }, 1500);
                }
            }
            
            // Spuštění hry
            function startGame() {
                initAudio(); // Inicializace zvuku při startu hry
                
                // Skrytí výběru režimu a zobrazení hry
                modeSelection.style.display = 'none';
                gameScreen.style.display = 'block';
                
                // Reset skóre a statistik
                score = 0;
                correctCount = 0;
                incorrectCount = 0;
                scoreElement.textContent = score;
                updateProgressBar();
                
                // Reset jednoduchých příkladů
                usedEasyProblems = {
                    multiplyByOne: false,
                    divideByOne: false,
                    multiplyByZero: false,
                    divideByItself: false
                };
                
                // Nastavení začátku času
                startTime = new Date();
                
                // Zobrazení/skrytí ovládacích prvků podle vybraného režimu
                if (currentMode === 3) { // Režim i/y
                    answerInput.style.display = 'none';
                    document.getElementById('check-btn').style.display = 'none';
                    // Tlačítka pro i/y se vytvoří v generateIYProblem
                } else { // Matematické režimy
                    answerInput.style.display = 'block';
                    document.getElementById('check-btn').style.display = 'inline-block';
                    // Skrýt tlačítka i/y, pokud existují
                    const iyButtons = document.getElementById('iy-buttons');
                    if (iyButtons) {
                        iyButtons.style.display = 'none';
                    }
                }
                
                // Generování prvního příkladu
                generateProblem();
            }
            
            // Funkce na kontrolu, zda je příklad jednoduchý
            function isEasyProblem(problem) {
                // Násobení jedničkou
                if (problem.operation === 'x' && (problem.num1 === 1 || problem.num2 === 1)) {
                    return 'multiplyByOne';
                }
                // Dělení jedničkou
                if (problem.operation === '÷' && problem.num2 === 1) {
                    return 'divideByOne';
                }
                // Násobení nulou
                if (problem.operation === 'x' && (problem.num1 === 0 || problem.num2 === 0)) {
                    return 'multiplyByZero';
                }
                // Dělení čísla sebou samým (s výjimkou 0)
                if (problem.operation === '÷' && problem.num1 === problem.num2 && problem.num1 !== 0) {
                    return 'divideByItself';
                }
                return null;
            }
            
            function generateProblem() {
                // Režim sčítání a odčítání do 100
                if (currentMode === 2) {
                    generateAddSubtractProblem();
                    return;
                }
                
                // Režim procvičování i/y v češtině
                if (currentMode === 3) {
                    generateIYProblem();
                    return;
                }
                
                let attempts = 0;
                let tempProblem;
                let problemType;
                
                // Pokus o vygenerování příkladu, který není jednoduchý nebo ještě nebyl použit
                do {
                    attempts++;
                    
                    // Režim násobilky a dělení
                    // Náhodně vybere operaci (násobilka nebo dělení)
                    const isMultiplication = Math.random() < 0.5;
                    
                    if (isMultiplication) {
                        // Násobilka: jedno číslo z definovaného rozsahu, druhé libovolné od 0 do 10
                        const rangeNumber = numbers[Math.floor(Math.random() * numbers.length)];
                        const otherNumber = allNumbers[Math.floor(Math.random() * allNumbers.length)];
                        
                        // Náhodně rozhodni, které číslo bude z definovaného rozsahu
                        if (Math.random() < 0.5) {
                            tempProblem = {
                                num1: rangeNumber,
                                num2: otherNumber,
                                operation: 'x',
                                answer: rangeNumber * otherNumber
                            };
                        } else {
                            tempProblem = {
                                num1: otherNumber,
                                num2: rangeNumber,
                                operation: 'x',
                                answer: otherNumber * rangeNumber
                            };
                        }
                    } else {
                        // Dělení: dělitel z definovaného rozsahu, výsledek musí být 0-10
                        const divisor = numbers[Math.floor(Math.random() * numbers.length)];
                        
                        // Vyhni se dělení nulou
                        if (divisor === 0) {
                            // Pokud je dělitel 0, generujeme násobení místo dělení
                            const randomNumber = allNumbers[Math.floor(Math.random() * allNumbers.length)];
                            tempProblem = {
                                num1: randomNumber,
                                num2: 0,
                                operation: 'x',
                                answer: 0
                            };
                        } else {
                            // Výsledek dělení musí být v rozsahu 0-10
                            const quotient = allNumbers[Math.floor(Math.random() * allNumbers.length)];
                            const dividend = quotient * divisor;
                            
                            tempProblem = {
                                num1: dividend,
                                num2: divisor,
                                operation: '÷',
                                answer: quotient
                            };
                        }
                    }
                    
                    problemType = isEasyProblem(tempProblem);
                    
                    // Pokud je příklad jednoduchý a už byl použit, pokračuj v generování
                    if (problemType && usedEasyProblems[problemType]) {
                        continue;
                    }
                    
                    // Pokud jsme se pokusili 15x a pořád máme jednoduchý příklad, použij ho
                    if (attempts > 15) {
                        break;
                    }
                    
                } while (problemType && usedEasyProblems[problemType]);
                
                // Pokud je příklad jednoduchý, označ ho jako použitý
                if (problemType) {
                    usedEasyProblems[problemType] = true;
                }
                
                currentProblem = tempProblem;
                
                problemElement.textContent = `${currentProblem.num1} ${currentProblem.operation} ${currentProblem.num2} = `;
                answerInput.value = '';
                answerInput.focus();
            }
            
            // Generování příkladu pro sčítání a odčítání do 100
            function generateAddSubtractProblem() {
                // Náhodně vybere operaci (sčítání nebo odčítání)
                const isAddition = Math.random() < 0.5;
                
                if (isAddition) {
                    // Sčítání
                    const num1 = Math.floor(Math.random() * 50) + 1; // 1-50
                    const num2 = Math.floor(Math.random() * 50) + 1; // 1-50
                    
                    currentProblem = {
                        num1: num1,
                        num2: num2,
                        operation: '+',
                        answer: num1 + num2
                    };
                } else {
                    // Odčítání (zajistíme, že výsledek bude kladný)
                    const num2 = Math.floor(Math.random() * 50) + 1; // 1-50
                    const num1 = num2 + Math.floor(Math.random() * 50) + 1; // vždy větší než num2
                    
                    currentProblem = {
                        num1: num1,
                        num2: num2,
                        operation: '-',
                        answer: num1 - num2
                    };
                }
                
                problemElement.textContent = `${currentProblem.num1} ${currentProblem.operation} ${currentProblem.num2} = `;
                answerInput.value = '';
                answerInput.focus();
            }
            
            function checkAnswer() {
                const userAnswer = parseInt(answerInput.value);
                
                if (isNaN(userAnswer)) {
                    feedbackElement.textContent = 'Zadej číslo!';
                    feedbackElement.className = 'feedback incorrect';
                    return;
                }
                
                if (userAnswer === currentProblem.answer) {
                    // Správná odpověď
                    score++;
                    correctCount++;
                    feedbackElement.textContent = 'Správně!';
                    feedbackElement.className = 'feedback correct';
                    createCelebration();
                    // Zvuková i vizuální zpětná vazba
                    playCorrectSound();
                    flashBackground('correct');
                } else {
                    // Špatná odpověď
                    score = Math.max(0, score - 1);
                    incorrectCount++;
                    feedbackElement.textContent = `Špatně! Správná odpověď je ${currentProblem.answer}.`;
                    feedbackElement.className = 'feedback incorrect';
                    // Zvuková i vizuální zpětná vazba
                    playWrongSound();
                    flashBackground('incorrect');
                }
                
                scoreElement.textContent = score;
                updateProgressBar();
                updateSuccessRate();
                
                // Kontrola, zda bylo dosaženo 50 bodů
                if (score >= 50) {
                    endGame();
                } else {
                    // Po krátké pauze generuje nový příklad
                    setTimeout(generateProblem, 1500);
                }
            }
            
            // Funkce pro vizuální zpětnou vazbu místo zvuku
            function flashBackground(type) {
                const container = document.querySelector('.container');
                const originalBackground = container.style.backgroundColor;
                
                if (type === 'correct') {
                    container.style.backgroundColor = '#c8f7c5'; // Zelené pozadí při správné odpovědi
                } else if (type === 'incorrect') {
                    container.style.backgroundColor = '#ffcccb'; // Červené pozadí při špatné odpovědi
                } else if (type === 'win') {
                    container.style.backgroundColor = '#fffacd'; // Žluté pozadí při výhře
                }
                
                setTimeout(() => {
                    container.style.backgroundColor = originalBackground;
                }, 300);
            }
            
            function updateSuccessRate() {
                const total = correctCount + incorrectCount;
                if (total > 0) {
                    const rate = Math.round((correctCount / total) * 100);
                    document.getElementById('current-success-rate').textContent = `${rate}%`;
                }
            }
            
            function updateProgressBar() {
                const progress = (score / 50) * 100;
                progressBar.style.width = `${progress}%`;
            }
            
            function createCelebration() {
                const container = document.querySelector('.container');
                const celebration = document.createElement('div');
                celebration.className = 'celebration';
                
                // Náhodná pozice horizontálně
                const xPos = Math.random() * 80 + 10;
                celebration.style.left = `${xPos}%`;
                
                // Náhodný emotikon pro oslavu
                const emojis = ['🎉', '⭐', '👍', '🥳', '😊', '🏆'];
                celebration.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                
                container.appendChild(celebration);
                
                // Odstranění animace po dokončení
                setTimeout(() => {
                    container.removeChild(celebration);
                }, 2000);
            }
            
            function endGame() {
                const endTime = new Date();
                const timeSpent = Math.floor((endTime - startTime) / 1000);
                const minutes = Math.floor(timeSpent / 60);
                const seconds = timeSpent % 60;
                
                totalTimeElement.textContent = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
                correctCountElement.textContent = correctCount;
                incorrectCountElement.textContent = incorrectCount;
                
                // Výpočet a zobrazení úspěšnosti
                const total = correctCount + incorrectCount;
                if (total > 0) {
                    const rate = Math.round((correctCount / total) * 100);
                    document.getElementById('success-rate').textContent = `${rate}%`;
                }
                
                // Vizuální efekt a zvuk
                flashBackground('win');
                playWinSound();
                
                gameScreen.style.display = 'none';
                resultScreen.style.display = 'block';
                
                // Přidat extra oslavnou animaci při dokončení
                celebrateWin();
            }
            
            // Funkce pro oslavu výhry
            function celebrateWin() {
                const container = document.querySelector('.container');
                
                // Přidat několik oslavných emotikonů najednou
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        createCelebration();
                    }, i * 100);
                }
                
                // Pulzující efekt pro hvězdičky
                const stars = document.querySelector('.stars');
                stars.style.animation = 'pulse 0.7s infinite alternate';
                
                // Přidat animaci pulzování
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes pulse {
                        0% { transform: scale(1); }
                        100% { transform: scale(1.1); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            function resetGame() {
                // Skrytí výsledkové obrazovky
                resultScreen.style.display = 'none';
                // Návrat na výběr režimu
                modeSelection.style.display = 'block';
                gameScreen.style.display = 'none';
                
                // Reset UI prvků
                answerInput.style.display = 'block';
                document.getElementById('check-btn').style.display = 'inline-block';
                const iyButtons = document.getElementById('iy-buttons');
                if (iyButtons) {
                    iyButtons.style.display = 'none';
                }
            }
            
            // Event listenery
            checkButton.addEventListener('click', function() {
                initAudio(); // Inicializace zvuku při první interakci uživatele
                checkAnswer();
            });
            
            restartButton.addEventListener('click', resetGame);
            
            answerInput.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    initAudio(); // Inicializace zvuku při první interakci uživatele
                    checkAnswer();
                }
            });
            
            // Inicializace UI
            setupModeSelection();
        });
    </script>
</body>
</html>